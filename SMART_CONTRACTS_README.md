# üöÄ Smart Contracts - PADD-R Staking System

## üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–µ–π–∫–∏–Ω–≥–∞:
- **4 —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–∏—Ä–∞** —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏
- **NFT –Ω–∞–≥—Ä–∞–¥—ã** –∫–∞–∂–¥—ã–π —á–∞—Å –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
- **–°–∏—Å—Ç–µ–º–∞ –≤–∞—É—á–µ—Ä–æ–≤** —Å QR-–∫–æ–¥–∞–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–æ–≤** –ø—Ä–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–µ

### –¢–∏—Ä—ã:
1. **Bronze**: 500 PADD-R —Ç–æ–∫–µ–Ω–æ–≤, —Å—Ç–µ–π–∫–∏–Ω–≥ –Ω–∞ 1 —á–∞—Å
2. **Silver**: 1000 PADD-R —Ç–æ–∫–µ–Ω–æ–≤, —Å—Ç–µ–π–∫–∏–Ω–≥ –Ω–∞ 2 —á–∞—Å–∞
3. **Gold**: 3000 PADD-R —Ç–æ–∫–µ–Ω–æ–≤, —Å—Ç–µ–π–∫–∏–Ω–≥ –Ω–∞ 3 —á–∞—Å–∞
4. **Platinum**: 4000 PADD-R —Ç–æ–∫–µ–Ω–æ–≤, —Å—Ç–µ–π–∫–∏–Ω–≥ –Ω–∞ 4 —á–∞—Å–∞

## üèóÔ∏è –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### 1. MultiStakeManager.sol
**–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–µ–π–∫–∏–Ω–≥–∞**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–º–º—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏—Ä–∞
- NFT –Ω–∞–≥—Ä–∞–¥—ã –∫–∞–∂–¥—ã–π —á–∞—Å
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å VoucherManager

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `REWARD_INTERVAL = 1 hours` (–±—ã–ª–æ 30 –º–∏–Ω—É—Ç)
- `MAX_STAKE_DURATION = 4 hours` (–±—ã–ª–æ 10 —á–∞—Å–æ–≤)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_validateTierAmount()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–º–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `VoucherManager` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞—É—á–µ—Ä–æ–≤

### 2. VoucherManager.sol
**–ù–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞—É—á–µ—Ä–∞–º–∏**
- –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–æ–≤ –ø—Ä–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–µ
- QR-–∫–æ–¥ —Å–∏—Å—Ç–µ–º–∞
- –¢—Ä–∏ —Ç–∏–ø–∞ –≤–∞—É—á–µ—Ä–æ–≤:
  - `SINGLE_USE`: –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ
  - `MULTI_USE`: –ú–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–µ —Å –ª–∏–º–∏—Ç–æ–º
  - `DURATION`: –ù–∞ –ø–µ—Ä–∏–æ–¥ —Å—Ç–µ–π–∫–∏–Ω–≥–∞

**–§—É–Ω–∫—Ü–∏–∏:**
- `createVouchersForPosition()`: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–æ–≤ –¥–ª—è –ø–æ–∑–∏—Ü–∏–∏
- `redeemVoucher()`: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–∞ –ø–æ QR-–∫–æ–¥—É
- `isVoucherValid()`: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –≤–∞—É—á–µ—Ä–∞
- `getUserVouchers()`: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞—É—á–µ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3. PADNFTFactory.sol
**–§–∞–±—Ä–∏–∫–∞ NFT**
- –°–æ–∑–¥–∞–Ω–∏–µ NFT –Ω–∞–≥—Ä–∞–¥
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∞—É—á–µ—Ä–æ–≤
- Soul-bound –ª–æ–≥–∏–∫–∞

## üîß –î–µ–ø–ª–æ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
```bash
cd contracts
npm install
npx hardhat compile
```

### 2. –î–µ–ø–ª–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
```bash
npx hardhat run scripts/deploy.js --network localhost
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥—Ä–µ—Å–æ–≤
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ–±–Ω–æ–≤–∏—Ç–µ –∞–¥—Ä–µ—Å–∞ –≤ `lib/contracts/config.ts`:
```typescript
export const VOUCHER_MANAGER_ADDRESS = '0x...'; // –ù–æ–≤—ã–π –∞–¥—Ä–µ—Å
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ–ª–µ–π
```javascript
// –î–∞—Ç—å —Ä–æ–ª—å ADMIN –¥–ª—è MultiStakeManager –≤ VoucherManager
await voucherManager.grantRole(ADMIN_ROLE, stakeManager.address);

// –î–∞—Ç—å —Ä–æ–ª—å MINTER –¥–ª—è MultiStakeManager –≤ NFTFactory
await nftFactory.grantRole(MINTER_ROLE, stakeManager.address);
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—Ç–µ–π–∫–∏–Ω–≥–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∏—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, Bronze)
const amount = 500 * 10**18; // 500 —Ç–æ–∫–µ–Ω–æ–≤
const duration = 1 * 60 * 60; // 1 —á–∞—Å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

// –í—ã–∑–æ–≤ createPosition
await stakeManager.createPosition(amount, duration);
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–æ–≤
```javascript
// –í createPosition –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
await voucherManager.createVouchersForPosition(user, positionId, tier);
```

### 3. NFT –Ω–∞–≥—Ä–∞–¥—ã
```javascript
// –ö–∞–∂–¥—ã–π —á–∞—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å NFT:
await stakeManager.mintNextNFT(positionId);
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–æ–≤
```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç QR-–∫–æ–¥
// –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç:
await voucherManager.redeemVoucher(qrCode, redeemer);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Å—Ç–µ–π–∫–∏–Ω–≥–∞
```bash
npx hardhat test test/Staking.test.js
```

### –¢–µ—Å—Ç –≤–∞—É—á–µ—Ä–æ–≤
```bash
npx hardhat test test/Vouchers.test.js
```

## üîç –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏—Ä–æ–≤
- –¢–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å—É–º–º–∞/–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- `_validateTierAmount()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 255 –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π

### 2. QR-–∫–æ–¥—ã
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∞—É—á–µ—Ä–∞
- –§–æ—Ä–º–∞—Ç: `voucher_{id}_{owner}_{positionId}_{timestamp}`
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `qrCodeUsed` mapping

### 3. NFT –Ω–∞–≥—Ä–∞–¥—ã
- –ö–∞–∂–¥—ã–π —á–∞—Å –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
- `nextMintAt` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ +1 —á–∞—Å
- –ú–∞–∫—Å–∏–º—É–º NFT = `duration / REWARD_INTERVAL`

### 4. –í–∞—É—á–µ—Ä—ã
- –°–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–µ
- 4 –≤–∞—É—á–µ—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏—Ä–∞
- –†–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏—Ä–∞

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤ VoucherManager:
- –¢–æ–ª—å–∫–æ `REDEEMER_ROLE` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—É—á–µ—Ä—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ QR-–∫–æ–¥–∞ –Ω–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –≤–∞—É—á–µ—Ä–∞ –∏ –ª–∏–º–∏—Ç–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤ MultiStakeManager:
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–º–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–æ–∑–∏—Ü–∏–π
- ReentrancyGuard –∑–∞—â–∏—Ç–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Events –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- `VoucherCreated`: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–∞
- `VoucherRedeemed`: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∞—É—á–µ—Ä–∞
- `PositionCreated`: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
- `NFTMinted`: –°–æ–∑–¥–∞–Ω–∏–µ NFT –Ω–∞–≥—Ä–∞–¥—ã

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ö—É–∫–∏:
- `useVouchers`: –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞—É—á–µ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `useStakingPositions`: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö —Ç–∏—Ä–æ–≤

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `VouchersPanel`: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∞—É—á–µ—Ä–æ–≤ —Å QR-–∫–æ–¥–∞–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å—Ç–µ–π–∫–∏–Ω–≥–∞: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–º–º—ã

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–µ–ø–ª–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤** –Ω–∞ —Ç–µ—Å—Ç–Ω–µ—Ç
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
4. **–ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
5. **–î–µ–ø–ª–æ–π** –Ω–∞ –º–µ–π–Ω–Ω–µ—Ç

---

**‚ö†Ô∏è –í–∞–∂–Ω–æ**: –í—Å–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ –º–µ–π–Ω–Ω–µ—Ç!
